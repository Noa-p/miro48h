!function(e,t){e&&!e.getElementById("livereloadscript")&&((t=e.createElement("script")).async=1,t.src="//"+(self.location.host||"localhost").split(":")[0]+":35729/livereload.js?snipver=1",t.id="livereloadscript",e.getElementsByTagName("head")[0].appendChild(t))}(self.document),function(){"use strict";var e={frameTagsOn:!1};const t={None:0,CreateFrame:1,UpdateFrameTitle:2,SeletAFrame:3,TagUpdated:4,DeleteFrame:5};const a=new class{constructor(){this._event=t.None,this.subs={},this.type=t}init(){o()}get event(){return this._event}set event(e){this._event=e}sub(e,t){void 0===this.subs[e]&&(this.subs[e]=[]),this.subs[e].push(t)}async $emit(e,t){if(this.subs[e])for(const a of this.subs[e])await a(t)}},i=(e,t)=>e.data.filter((e=>e.type===t)),o=()=>{miro.addListener("SELECTION_UPDATED",(t=>{const o=i(t,"FRAME");o.length&&e.frameTagsOn&&a.$emit(a.type.SeletAFrame,o)})),miro.addListener("WIDGETS_CREATED",(t=>{const o=i(t,"FRAME");o.length&&e.frameTagsOn&&a.$emit(a.type.CreateFrame,o)})),miro.addListener("METADATA_CHANGED",(t=>{const o=i(t,"FRAME");o.length&&e.frameTagsOn&&a.$emit(a.type.TagUpdated,o)})),miro.addListener("CANVAS_CLICKED",(e=>{})),miro.addListener("WIDGETS_TRANSFORMATION_UPDATED",(e=>{})),miro.addListener("WIDGETS_DELETED",(async t=>{const i=[];for(const e of t.data){const t=await miro.board.widgets.get({id:e.id});"FRAME"==t.type&&i.push(t)}i.length&&e.frameTagsOn&&a.$emit(a.type.DeleteFrame,i)}))};var s={name:"State",values:{todo:"todo",doing:"doing",done:"done",undermodified:"undermodified"}};const n=process.env.CLIENT_ID,r=e=>`${e}$container`,d=e=>`$${e}`;var c=r,m=async e=>(await miro.board.widgets.get({id:e}))[0].metadata[n],l=async e=>await fetch("/"),g=(e,t,a,i)=>({[n]:{[e.name]:a,[r(e.name)]:t,[d(e.name)]:void 0===i?e.values[a]:i}});const f=async(e,t,a)=>{const i=await miro.board.widgets.get({id:e.id}),o=await miro.board.widgets.create({type:"SHAPE",title:s.values.todo,width:200,height:i[0].height,x:i[0].x-i[0].width/2+100,y:i[0].y,style:{backgroundColor:"#000"}});e.metadata=g(t,o[0].id,a),await miro.board.widgets.update(e)};var h=f,u=async(e,t,a)=>{const i=await m(e.id);if(!i||!i[t.name])return void f(e,t,a);const o=i[c(t.name)];console.log("containerId",o);0===(await miro.board.widgets.get({id:o})).length&&f(e,t,i[t.name])},y=async e=>{const t=await l(e.id);for(const a of t)await miro.board.widgets.deleteById(e.metadata[CLIENT_ID][`${a}$container`])};const w=async()=>{miro.board.ui.openLeftSidebar("sidebar.html")},p=async()=>{e.frameTagsOn=!0,a.init();await miro.initialize({extensionPoints:{bottomBar:{title:"smart frame",svgIcon:'<circle cx="12" cy="12" r="9" fill="none" fill-rule="evenodd" stroke="currentColor" stroke-width="2"/>',onClick:w}}}),a.sub(a.type.CreateFrame,(async e=>{for(const t of e)h(t,s,"todo")})),a.sub(a.type.DeleteFrame,(async e=>{for(const t of e)y(t)})),a.sub(a.type.SeletAFrame,(async e=>{for(const t of e)console.log(await miro.board.widgets.get({id:t.id})),u(t,s,"todo"),console.log(await miro.board.widgets.get({id:t.id}))}))};miro.onReady((async()=>{if(await miro.isAuthorized())p();else{"success"===await miro.board.ui.openModal("not-authorized.html")&&p()}}))}();
