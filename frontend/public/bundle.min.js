!function(e,t){e&&!e.getElementById("livereloadscript")&&((t=e.createElement("script")).async=1,t.src="//"+(self.location.host||"localhost").split(":")[0]+":35729/livereload.js?snipver=1",t.id="livereloadscript",e.getElementsByTagName("head")[0].appendChild(t))}(self.document),function(){"use strict";var e={frameTagsOn:!1};const t={None:0,CreateFrame:1,SelectFrames:3,ContainerUpdated:4,DeleteFrame:5},a=new class{constructor(e){this._event=null,this.subs={},this.type=e}init(){s()}get event(){return this._event}set event(e){this._event=e}sub(e,t){void 0===this.subs[e]&&(this.subs[e]=[]),this.subs[e].push(t)}async $emit(e,t){if(this.subs[e])for(const a of this.subs[e])await a(t)}}(t),o=(e,t)=>e.filter((e=>e.type===t)),n=(e,t,a)=>{const n=e=>e.reduce(((e,t)=>(e[t.id]=t,e)),{}),i=n(e),r=n(t),s=[],c=[];for(const t of e)null==r[t.id]&&s.push(t);for(const e of t)if(void 0===i[e.id]){c.push(e);break}return{a:o(s,a),b:o(c,a)}};let i=null,r=null;const s=()=>setInterval((async()=>{e.frameTagsOn&&(await miro.board.get().then((e=>{if(!i)return void(i=e);const o=n(i,e,"frame");o.a.length>0&&a.$emit(t.DeleteFrame,o.a),o.b.length>0&&a.$emit(t.CreateFrame,o.b),i=e})),await miro.board.getSelection().then((e=>{if(!r)return void(r=e);const o=n(r,e,"frame");o.b.length>0&&a.$emit(t.SelectFrames,o.b),r=e})))}),1e3);var c={name:"State",values:{todo:"todo",doing:"doing",done:"done",undermodified:"undermodified"}};const d=(e,t)=>miro.board.setAppData(e,t),l=e=>miro.board.getAppData(e);var m={set:d,update:async(e,t)=>{const a=await l(e);return"object"==typeof a&&"object"==typeof t?(Object.assign(a,t),d(e,a)):d(e,t)},get:l};const h=e=>`${e}$container`,p=e=>`$${e}`,u=(e,t,a,o)=>({[e.name]:a,[h(e.name)]:t,[p(e.name)]:void 0===o?e.values[a]:o});var g=h,b=(e,t,a,o,n)=>m.set(e,u(t,a,o,n)),f={createFrame:e=>miro.board.createFrame(e).then((e=>(a.$emit(a.type.createFrame,e),e))),createShapeContainer:e=>miro.board.createShape(e).then((e=>(a.$emit(a.type.ContainerUpdated,e),e))),createTextContainer:e=>miro.board.createText(e).then((e=>(a.$emit(a.type.ContainerUpdated,e),e)))};const v=async(e,t,a)=>{const o=await f.createShapeContainer({shape:"rectangle",content:c.values.todo,width:200,height:e.height,x:e.x-e.width/2+100,y:e.y,style:{fillColor:"#000"}});return await e.add(o),b(e.id,t,o.id,a)};var y=async(e,t,a)=>{console.log(e.id);const o=await miro.board.getAppData(e.id);if(!o||!o[t.name])return console.log(o[t.name]),v(e,t,a);const n=o[g(t.name)];console.log("containerId",n);return 0===(await miro.board.get({id:n})).length?v(e,t,o[t.name]):void 0};console.log("hello plugin loaded"),miro.board.ui.on("icon:click",(async()=>{console.log("icon clicked"),(async()=>{e.frameTagsOn=!0,a.init(),a.sub(a.type.SelectFrames,(async e=>{for(const t of e)console.log(t.id),console.log(await miro.board.getAppData(t.id)),await y(t,c,"todo"),console.log(await miro.board.getAppData(t.id))}))})()}))}();
