!function(e,t){e&&!e.getElementById("livereloadscript")&&((t=e.createElement("script")).async=1,t.src="//"+(self.location.host||"localhost").split(":")[0]+":35729/livereload.js?snipver=1",t.id="livereloadscript",e.getElementsByTagName("head")[0].appendChild(t))}(self.document),function(){"use strict";var e={frameTagsOn:!1};const t={None:0,CreateFrame:1,SelectFrames:3,ContainerUpdated:4,DeleteFrame:5,TagsUpdated:6},a=new class{constructor(e){this._event=null,this.subs={},this.type=e}init(){r()}get event(){return this._event}set event(e){this._event=e}sub(e,t){void 0===this.subs[e]&&(this.subs[e]=[]),this.subs[e].push(t)}async $emit(e,t){if(this.subs[e])for(const a of this.subs[e])await a(t)}}(t),n=(e,t)=>e.filter((e=>e.type===t)),o=(e,t,a)=>{const o=e=>e.reduce(((e,t)=>(e[t.id]=t,e)),{}),i=o(e),s=o(t),r=[],c=[];for(const t of e)null==s[t.id]&&r.push(t);for(const e of t)if(void 0===i[e.id]){c.push(e);break}return{a:n(r,a),b:n(c,a)}};let i=null,s=null;const r=()=>setInterval((async()=>{e.frameTagsOn&&(await miro.board.get().then((e=>{if(!i)return void(i=e);const n=o(i,e,"frame");n.a.length>0&&a.$emit(t.DeleteFrame,n.a),n.b.length>0&&a.$emit(t.CreateFrame,n.b),i=e})),await miro.board.getSelection().then((e=>{if(!s)return void(s=e);const n=o(s,e,"frame");n.b.length>0&&a.$emit(t.SelectFrames,n.b),s=e})))}),800);var c={name:"State",values:{todo:"todo",doing:"doing",done:"done",undermodified:"undermodified"}},l={name:"Owner"},d="6199a73b83ad7a74a1c3ef05";const m="https://xxantash.lc-cn-n1-shared.com",h={"X-LC-Id":"xxANTAShS739RtzLBQywDMMu-gzGzoHsz","X-LC-Key":"MaxXf4hdaoRRBQFxJenariKt","Content-Type":"application/json"},p=async(e,t)=>{const a=m+"/1.1/classes/appData/"+d,n=await u();return n[e]=t,fetch(a,{body:`{"data": ${JSON.stringify(n)}}`,headers:h,method:"PUT"}).then((e=>e.json()))},g=async e=>(await u())[e],u=async()=>fetch(m+"/1.1/classes/appData/"+d,{headers:h,method:"GET"}).then((e=>e.json())).then((e=>e.data));var b={set:p,update:async(e,t)=>{const a=await g(e);return"object"==typeof a&&"object"==typeof t?(Object.assign(a,t),p(e,a)):p(e,t)},get:g,getall:u};const f=e=>`${e}_container`,y=e=>`_${e}`,w=(e,t,a,n)=>({[e.name]:a,[f(e.name)]:t,[y(e.name)]:void 0===n?e.values[a]:n});var v=f,C=y,T=(e,t,n,o,i)=>b.update(e,w(t,n,o,i)).then((e=>(a.$emit(a.type.TagsUpdated,e),e))),x=e=>b.get(e),D=()=>b.getall(),F={createFrame:e=>miro.board.createFrame(e).then((e=>(a.$emit(a.type.createFrame,e),e))),createShapeContainer:e=>miro.board.createShape(e).then((e=>(a.$emit(a.type.ContainerUpdated,e),e))),createTextContainer:e=>miro.board.createText(e).then((e=>(a.$emit(a.type.ContainerUpdated,e),e)))};const S=async(e,t,a,n,o)=>{const i=await F.createShapeContainer({shape:"rectangle",content:o||a.values[n],width:200,height:t.height,x:t.x-t.width/2+100,y:t.y,style:{fillColor:"#000"},...e});return await t.add(i),T(t.id,a,i.id,n,o)},$=async(e,t,a,n,o)=>{const i=await x(t.id);if(console.log(i),!i||!i[a.name])return S(e,t,a,n,o);const s=i[v(a.name)];console.log("containerId",s);return 0===(await miro.board.get({id:s})).length?S(e,t,a,i[a.name],i[C(a.name)]):void 0};var j=$,A=async()=>{const e=await D(),t=[],a=Object.keys(e).filter((t=>e[t][c.name]&&e[t][l.name]));let n=await miro.board.get({id:a});return n=n.reduce(((e,t)=>(e[t.id]=t,e)),{}),a.forEach((a=>{t.push({frameData:n[a],state:{type:e[a][c.name],text:e[a][C(c.name)]},owner:{id:e[a][l.name],name:e[a][C(l.name)]}})})),t};console.log("hello plugin loaded"),miro.board.ui.on("icon:click",(async()=>{console.log("icon clicked"),(async()=>{console.log(await b.getall()),console.log(await A()),e.frameTagsOn=!0,a.init(),await miro.board.setAppData("123",123),console.log(await miro.board.getAppData("123")),await miro.board.setAppData("456",{bob:"alice"}),console.log(await miro.board.getAppData("456")),setTimeout((async()=>{console.log(await miro.board.getAppData("456"))}),2e3),await miro.board.ui.openPanel({pageUrl:"panel.html",maxHeight:420}),a.sub(a.type.SelectFrames,(async e=>{for(const t of e)console.log(t.id),await j({height:50},t,c,"todo"),await j({height:50,style:{fillColor:"#b22222"}},t,l,"<userId>","mengru")}))})()}))}();
