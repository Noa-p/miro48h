!function(e,t){e&&!e.getElementById("livereloadscript")&&((t=e.createElement("script")).async=1,t.src="//"+(self.location.host||"localhost").split(":")[0]+":35729/livereload.js?snipver=1",t.id="livereloadscript",e.getElementsByTagName("head")[0].appendChild(t))}(self.document),function(){"use strict";var e={frameTagsOn:!1};const t={None:0,CreateFrame:1,UpdateFrameTitle:2,SeletAFrame:3,TagUpdated:4};const a=new class{constructor(){this._event=t.None,this.subs={},this.type=t}init(){n()}get event(){return this._event}set event(e){this._event=e}sub(e,t){void 0===this.subs[e]&&(this.subs[e]=[]),this.subs[e].push(t)}async $emit(e,t){if(this.subs[e])for(const a of this.subs[e])await a(t)}},i=(e,t)=>e.data.filter((e=>e.type===t)),n=()=>{miro.addListener("SELECTION_UPDATED",(t=>{const n=i(t,"FRAME");n.length&&e.frameTagsOn&&a.$emit(a.type.SeletAFrame,n)})),miro.addListener("WIDGETS_CREATED",(t=>{const n=i(t,"FRAME");n.length&&e.frameTagsOn&&a.$emit(a.type.CreateFrame,n)})),miro.addListener("METADATA_CHANGED",(t=>{const n=i(t,"FRAME");n.length&&e.frameTagsOn&&a.$emit(a.type.TagUpdated,n)})),miro.addListener("CANVAS_CLICKED",(e=>{})),miro.addListener("WIDGETS_TRANSFORMATION_UPDATED",(e=>{})),miro.addListener("WIDGETS_DELETED",(e=>{}))};var o={name:"State",values:{todo:"todo",doing:"doing",done:"done"}};const{ClientID:s}={ClientID:"3074457367848344047"};function r(e){return`${e}$container`}function d(e){return`$${e}`}var c={ContainerKey:r,TagTextKey:d,UpdateTag:function(){},GetFrameIdsByATag:function(){},GetTagsByFrameId:async function(e){return(await miro.board.widgets.get({id:e}))[0].metadata[s]},Metadata:function(e,t,a,i){return{[s]:{[e.name]:a,[r(e.name)]:t,[d(e.name)]:void 0===i?e.values[a]:i}}}};const m=async(e,t,a)=>{const i=await miro.board.widgets.get({id:e.id}),n=await miro.board.widgets.create({type:"card",title:o.values.todo,x:i[0].x,y:i[0].y});e.metadata=c.Metadata(t,n[0].id,a),await miro.board.widgets.update(e)};var l=m,g=async(e,t,a)=>{const i=await c.GetTagsByFrameId(e.id);if(!i||!i[t.name])return void m(e,t,a);const n=i[c.ContainerKey(t.name)];console.log("containerId",n);0===(await miro.board.widgets.get({id:n})).length&&m(e,t,i[t.name])};const u=async()=>{e.frameTagsOn=!0,a.init();await miro.initialize({extensionPoints:{bottomBar:{title:"smart frame",svgIcon:'<circle cx="12" cy="12" r="9" fill="none" fill-rule="evenodd" stroke="currentColor" stroke-width="2"/>',onClick:()=>{alert("Bottom bar item has been clicked")}}}}),a.sub(a.type.CreateFrame,(async e=>{for(const t of e)l(t,o,"todo")})),a.sub(a.type.SeletAFrame,(async e=>{for(const t of e)console.log(await miro.board.widgets.get({id:t.id})),g(t,o,"todo"),console.log(await miro.board.widgets.get({id:t.id}))}))};miro.onReady((async()=>{if(await miro.isAuthorized())u();else{"success"===await miro.board.ui.openModal("not-authorized.html")&&u()}}))}();
